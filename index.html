<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Access Portal | Enterprise Login</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- New Design Variables and Global Resets --- */
        :root {
            --primary: #00ff88;
            --secondary: #0f2027;
            --accent: #2c5364;
            --text: #eef3f6;
            --input-bg: rgba(255,255,255,0.1);
            --modal-bg: rgba(255,255,255,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* --- Body and Background (From New Design) --- */
        body {
            font-family: 'Inter', sans-serif; /* Changed font to Inter */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to right, #0f2027, #203a43, #2c5364); /* New background gradient */
            color: var(--text); /* New text color */
            position: relative;
            overflow: hidden; /* Important for particles */
        }

        /* --- Particle Animation (From New Design) --- */
        .particle {
            position: absolute;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0; /* Ensure particles are behind content */
        }

        @keyframes particle-flow {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; }
        }

        /* --- Login Container (Adapted from New Design) --- */
        .login-container {
            background: var(--modal-bg); /* Use new background for glassmorphism */
            backdrop-filter: blur(15px); /* Glassmorphism effect */
            padding: 3rem; /* Adjusted padding */
            border-radius: 20px; /* More rounded corners */
            box-shadow: 0 25px 45px rgba(0,0,0,0.2); /* Enhanced shadow */
            width: 90%;
            max-width: 500px; /* Slightly larger max-width */
            position: relative;
            transform: translateY(0);
            animation: float 6s ease-in-out infinite; /* Floating animation */
            border: 1px solid rgba(255,255,255,0.1); /* Subtle border */
            z-index: 1; /* Ensure content is above particles */
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* --- Login Header (From New Design) --- */
        .login-header {
            text-align: center;
            margin-bottom: 2.5rem; /* More spacing */
        }

        .login-header h1 {
            font-size: 2.5rem; /* Larger heading */
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, var(--primary), #00ccff); /* Gradient text */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .login-header p {
            color: var(--text);
            opacity: 0.8;
        }

        /* --- Input Group (Adapted from New Design) --- */
        .input-group {
            margin-bottom: 1.5rem; /* Adjusted spacing */
            position: relative; /* For icon positioning */
            text-align: left; /* Keep labels left-aligned if present, otherwise input dictates */
        }

        .input-group label {
            display: block; /* Ensure label is on its own line */
            margin-bottom: 0.5rem; /* Space between label and input */
            color: var(--text);
            font-weight: 500; /* Slightly lighter weight */
            font-size: 0.95em;
            opacity: 0.8;
        }

        .input-group i { /* New icon styling */
            position: absolute;
            left: 15px;
            top: 50%; /* Adjusted for inputs with labels */
            transform: translateY(-50%);
            color: var(--primary);
            transition: 0.3s;
        }

        /* Adjust icon position if label is not present and input is the only child */
        .input-group:not(:has(label)) input + i {
            top: 50%;
            transform: translateY(-50%);
        }

        .input-group input[type="email"],
        .input-group input[type="password"],
        .input-group input[type="text"],
        .input-group input[type="tel"] {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem; /* Padding for icon */
            border: none;
            background: var(--input-bg); /* New input background */
            border-radius: 8px; /* More rounded */
            color: var(--text);
            font-size: 1rem;
            transition: 0.3s;
            box-sizing: border-box; /* Crucial for padding/width */
        }

        .input-group input::placeholder { /* Placeholder color */
            color: rgba(255,255,255,0.5);
        }

        .input-group input:focus {
            outline: none;
            background: rgba(255,255,255,0.15); /* Slightly brighter on focus */
            box-shadow: 0 0 15px rgba(0,255,136,0.2); /* Glow effect */
        }

        /* --- Password Strength (From New Design - Added for Reg Form) --- */
        .password-strength {
            height: 4px;
            background: rgba(255,255,255,0.1);
            margin-top: 0.5rem;
            border-radius: 2px;
            overflow: hidden;
            position: relative;
        }

        .strength-bar {
            height: 100%;
            width: 0;
            background: var(--primary);
            transition: width 0.3s ease-in-out; /* Smooth transition for width */
        }

        /* --- Buttons (Adapted from New Design) --- */
        button[type="submit"],
        .popup-content button { /* Apply to all buttons */
            width: 100%;
            padding: 1rem; /* Adjusted padding */
            background: linear-gradient(135deg, var(--primary), #00ccff); /* New button gradient */
            border: none;
            border-radius: 8px; /* More rounded */
            color: var(--secondary); /* Darker text for contrast */
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            position: relative;
            overflow: hidden;
            font-size: 1.1em; /* Slightly smaller than original, fits new design better */
        }

        button[type="submit"]:hover,
        .popup-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,255,136,0.3); /* New hover shadow */
        }

        button[type="submit"]:active,
        .popup-content button:active {
            transform: translateY(0);
        }

        /* Spinner for submit button (from new design) */
        .spinner {
            display: none; /* Hidden by default */
            animation: spin 1s linear infinite;
            margin: 0 auto; /* Center spinner */
            color: var(--secondary); /* Match button text color */
            font-size: 1.2em;
        }

        .button-text {
            transition: opacity 0.3s;
        }

        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        /* --- Auth Methods (From New Design) --- */
        .auth-methods {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0; /* Adjusted margin */
            border-top: 1px solid rgba(255,255,255,0.1); /* Separator line */
            padding-top: 2rem; /* Padding above buttons */
            position: relative;
        }

        .auth-methods::before {
            content: "Or login with"; /* Default text for login */
            position: absolute;
            top: -0.75rem; /* Position above the line */
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(to right, #0f2027, #203a43, #2c5364); /* Match body background */
            padding: 0 10px;
            color: rgba(255,255,255,0.7);
            font-size: 0.9em;
        }
        /* Specific text for registration auth methods */
        #registrationOverlay .auth-methods::before {
            content: "Or sign up with";
            background: linear-gradient(to right, #001217, #011d27, #012932); /* Match popup background blend */
        }


        .auth-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1.2em;
            color: var(--text); /* Default icon color */
            text-decoration: none; /* Remove underline */
        }

        .auth-btn:hover {
            background: var(--primary);
            transform: translateY(-3px);
            color: var(--secondary); /* Change icon color on hover */
        }

        /* Specific icon colors for better branding */
        .auth-btn .fa-google { color: #DB4437; } /* Google Red */
        .auth-btn .fa-apple { color: #f2f2f7; } /* Apple White */
        .auth-btn .fa-microsoft { color: #00A4EF; } /* Microsoft Blue */

        .auth-btn:hover .fa-google,
        .auth-btn:hover .fa-apple,
        .auth-btn:hover .fa-microsoft {
            color: var(--secondary); /* Icons become dark on hover with primary background */
        }

        /* --- Links (Adapted from New Design) --- */
        .links {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.95em; /* Keep original font size for readability */
        }

        .links a {
            color: var(--primary); /* New link color */
            text-decoration: none;
            margin: 0 1rem; /* Adjusted margin */
            position: relative;
            transition: color 0.3s ease;
        }

        .links a::after { /* Underline animation */
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: 0.3s;
        }

        .links a:hover::after {
            width: 100%;
        }

        /* --- Message Box (Retained from Old Design, styled for new look) --- */
        .message {
            margin-top: 1.5rem; /* Adjusted spacing */
            padding: 0.8rem; /* Adjusted padding */
            border-radius: 6px;
            display: none; /* Hidden by default */
            font-size: 0.9em; /* Slightly smaller font */
            font-weight: 500;
            text-align: center;
            color: var(--secondary); /* Darker text for contrast */
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .message.success {
            background-color: #d4edda; /* Light green */
            color: #155724; /* Dark green text */
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background-color: #f8d7da; /* Light red */
            color: #721c24; /* Dark red text */
            border: 1px solid #f5c6cb;
        }

        /* --- Global Popup Styles (Adapted from New Design) --- */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7); /* Darker overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0s 0.3s; /* Transition for visibility */
            backdrop-filter: blur(5px); /* Subtle blur for background */
        }

        .overlay.active {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.3s ease, visibility 0s 0s; /* Faster transition when active */
        }

        .popup-content {
            background: var(--modal-bg); /* Glassmorphism background */
            padding: 2.5rem; /* Consistent padding */
            border-radius: 20px; /* Consistent border-radius */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 500px; /* Consistent max-width */
            text-align: center;
            position: relative;
            transform: scale(0.8); /* Scale-in animation */
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            backdrop-filter: blur(15px); /* Glassmorphism blur */
            border: 1px solid rgba(255,255,255,0.1); /* Subtle border */
            color: var(--text); /* Text color for popups */
        }

        .overlay.active .popup-content {
            transform: scale(1);
            opacity: 1;
        }

        .popup-content h3 {
            margin-bottom: 2rem; /* Adjusted spacing */
            color: var(--primary); /* Accent color for headings */
            font-size: 2em; /* Consistent heading size */
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), #00ccff); /* Gradient text */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .popup-content .input-group {
            margin-bottom: 1.2rem; /* Adjusted spacing */
        }

        .popup-content .input-group input {
            padding: 0.9rem 1rem 0.9rem 3rem; /* Slightly less padding for popup inputs, still space for icon */
        }

        .checkbox-group {
            margin-top: 1.5rem; /* Adjusted spacing */
            margin-bottom: 2rem; /* Adjusted spacing */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            color: var(--text);
            opacity: 0.8;
            padding-left: 5px; /* Small padding to align checkbox with text */
        }

        .checkbox-group.login-terms {
            justify-content: flex-start; /* Align to left for login form */
            font-size: 0.85em; /* Keep original font size */
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
            /* Basic styling for checkbox to fit theme */
            appearance: none;
            background-color: var(--input-bg);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            display: inline-block;
            position: relative;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .checkbox-group input[type="checkbox"]:checked {
            background-color: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-group input[type="checkbox"]:checked::after {
            content: '\2713'; /* Checkmark character */
            color: var(--secondary); /* Darker checkmark color */
            font-size: 14px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Removed disabled style as it's not needed now for the main checkbox functionality */
        /* .checkbox-group input[type="checkbox"]:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        } */


        .checkbox-group label a {
            color: var(--primary); /* New link color */
            text-decoration: none;
            transition: color 0.3s ease;
            cursor: pointer;
        }

        .checkbox-group label a:hover {
            text-decoration: underline;
            color: #00ccff; /* Slightly different hover color */
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 2em;
            color: var(--text); /* New close button color */
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        .close-button:hover {
            color: var(--primary); /* Accent color on hover */
            transform: rotate(90deg); /* Spin on hover */
        }

        /* Specific styles for Forgot Password */
        #forgotPasswordPopup .content {
            text-align: left;
        }

        #forgotPasswordPopup p {
            margin-bottom: 1rem; /* Adjusted spacing */
            line-height: 1.5;
            font-size: 1em; /* Slightly smaller font */
            color: var(--text);
            opacity: 0.8;
        }

        #forgotPasswordPopup .clickable-link {
            color: var(--primary);
            text-decoration: underline;
            cursor: pointer;
        }

        #forgotPasswordPopup .timer {
            font-size: 1em; /* Slightly smaller font */
            font-weight: bold;
            color: #dc3545; /* Red for timer */
            margin-top: 1rem;
            text-align: center;
        }

        #credentialsPopup {
            max-width: 550px; /* Wider for credentials display */
            padding: 3rem; /* Consistent padding */
        }

        #credentialsPopup h3 {
            color: var(--primary); /* Consistent heading color */
            margin-bottom: 1.5rem; /* Adjusted spacing */
            background: linear-gradient(to right, var(--primary), #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #credentialsPopup .credentials-info {
            background-color: rgba(0, 255, 136, 0.1); /* Light green tint from primary */
            border: 1px solid rgba(0, 255, 136, 0.3);
            padding: 1.5rem; /* Adjusted padding */
            border-radius: 8px;
            margin-bottom: 2rem; /* Adjusted spacing */
            font-size: 1em;
            text-align: left;
            color: var(--text);
        }

        #credentialsPopup .credentials-info p {
            margin: 0.5rem 0;
            color: var(--text); /* Ensure text is visible */
        }

        #credentialsPopup .credentials-info strong {
            color: var(--primary); /* Accent color for strong text */
        }

        #credentialsPopup .action-button {
            background: linear-gradient(135deg, #6c757d, #495057); /* Gray gradient for redirect button */
            margin-top: 1rem;
        }

        #credentialsPopup .action-button:hover {
            background: linear-gradient(135deg, #5a6268, #343a40);
        }

        /* Terms and Conditions Popup specific styles */
        #termsAndConditionsPopup {
            max-width: 600px;
            padding: 3rem;
        }

        #termsAndConditionsPopup h3 {
            margin-bottom: 1.5rem;
            font-size: 2em;
        }

        #termsAndConditionsPopup .terms-content {
            max-height: 300px; /* Fixed height for scrollable content */
            overflow-y: auto; /* Enable scrolling */
            padding-right: 15px; /* Space for scrollbar */
            margin-bottom: 1.5rem;
        }

        /* Custom scrollbar for terms content */
        #termsAndConditionsPopup .terms-content::-webkit-scrollbar {
            width: 8px;
        }

        #termsAndConditionsPopup .terms-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        #termsAndConditionsPopup .terms-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        #termsAndConditionsPopup .terms-content::-webkit-scrollbar-thumb:hover {
            background: #00ccff;
        }


        #termsAndConditionsPopup .terms-content p {
            text-align: left;
            margin-bottom: 1rem;
            line-height: 1.6;
            color: var(--text);
            opacity: 0.9;
        }

        #termsAndConditionsPopup .terms-content p:first-child {
            color: #ff6b6b; /* Softer red for warning */
            font-weight: bold;
            font-size: 1.1em;
            opacity: 1;
        }

        /* Simulated OAuth Popup Specific Styles */
        /* Also applies to new Registration Post-Submit Popup */
        #simulatedOAuthPopup .step-content,
        #registrationCountryPasswordPopup .step-content {
            display: none; /* Hidden by default */
            text-align: center;
        }

        #simulatedOAuthPopup .step-content.active,
        #registrationCountryPasswordPopup .step-content.active {
            display: block; /* Active step is shown */
        }

        #simulatedOAuthPopup .step-content p,
        #registrationCountryPasswordPopup .step-content p {
            margin-bottom: 1.5rem;
            font-size: 1.1em;
            line-height: 1.6;
            opacity: 0.9;
        }

        #simulatedOAuthPopup .input-group,
        #registrationCountryPasswordPopup .input-group {
            margin-bottom: 1rem; /* Adjust spacing for inputs within popup */
        }

        #simulatedOAuthPopup .message,
        #registrationCountryPasswordPopup .message {
            margin-top: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85em;
        }

        #simulatedOAuthPopup .robot-options {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }

        #simulatedOAuthPopup .robot-options button {
            width: 48%; /* Two buttons side by side */
            padding: 0.8rem;
            font-size: 1em;
        }

        /* New styles for Country Select in OAuth popup and new registration popup */
        #oauthSignupStep1 select,
        #regPopupCountry select {
            width: 100%;
            padding: 0.9rem 1rem;
            border: none;
            background: var(--input-bg);
            border-radius: 8px;
            color: black; /* Black color for country text */
            font-size: 1rem;
            transition: 0.3s;
            box-sizing: border-box;
            appearance: none; /* Remove default dropdown arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20256%20256%22%3E%3Cpath%20fill%3D%22%23eef3f6%22%20d%3D%22M128%2C192a8%2C8%2C0%2C0%2C1-5.66-2.34l-80-80a8%2C8%2C0%2C0%2C1%2C11.32-11.32L128%2C173.31l74.34-74.33a8%2C8%2C0%2C0%2C1%2C11.32%2C11.32l-80%2C80A8%2C8%2C0%2C0%2C1%2C128%2C192Z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            margin-top: 0.5rem; /* Space between label and select */
        }
        #oauthSignupStep1 select:focus,
        #regPopupCountry select:focus {
            outline: none;
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 15px rgba(0,255,136,0.2);
        }
        /* Style for select options to ensure black text */
        #oauthSignupStep1 select option,
        #regPopupCountry select option {
            color: black;
            background-color: white; /* Ensure background is white for black text visibility */
        }

        /* Loading spinner animation for the popup itself */
        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-spinner-large {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: rotate360 1s linear infinite;
            margin: 2rem auto;
        }

        /* New popup for registration Country/Password steps */
        #registrationCountryPasswordPopup {
            max-width: 500px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .login-container,
            .popup-content {
                padding: 2rem;
                margin: 1rem;
                max-width: 95%; /* Adjust for smaller screens */
            }

            .login-header h1,
            .popup-content h3 {
                font-size: 2rem;
            }

            .input-group input {
                font-size: 0.95rem;
                padding: 0.8rem 0.8rem 0.8rem 2.5rem;
            }

            .input-group i {
                left: 10px;
            }

            button[type="submit"],
            .popup-content button {
                font-size: 1em;
                padding: 0.9rem;
            }

            .links a {
                margin: 0 0.5rem;
            }

            .checkbox-group {
                font-size: 0.8em;
            }

            .auth-methods {
                flex-direction: row; /* Keep row for small screens, less gap */
                justify-content: center;
            }

            .auth-btn {
                width: 40px; /* Slightly smaller buttons */
                height: 40px;
                font-size: 1.1em;
            }

            #simulatedOAuthPopup .robot-options {
                flex-direction: column; /* Stack buttons on small screens */
                gap: 0.5rem;
            }

            #simulatedOAuthPopup .robot-options button {
                width: 100%;
            }

            #oauthSignupStep1 select,
            #regPopupCountry select {
                font-size: 0.95rem;
                padding: 0.8rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>

    <div class="login-container">
        <div class="login-header">
            <h1>Welcome Back!</h1>
            <p>Enterprise-grade authentication system</p>
        </div>

        <form class="login-form" id="loginForm">
            <div class="input-group">
                <i class="fas fa-envelope"></i>
                <label for="email" style="display: none;">Email Address</label>
                <input type="email" id="email" name="email" required placeholder="Enter your email">
            </div>
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <label for="password" style="display: none;">Password</label>
                <input type="password" id="password" name="password" required placeholder="Enter your password">
                <div class="password-strength" style="display: none;">
                    <div class="strength-bar"></div>
                </div>
            </div>
            <div class="checkbox-group login-terms">
                <input type="checkbox" id="loginTermsAccepted" required>
                <label for="loginTermsAccepted">By clicking Login, you accept our <a href="#" class="viewTermsLink" data-target-checkbox="loginTermsAccepted" style="margin:0; text-decoration: underline;">terms and conditions</a>.</label>
            </div>
            <button type="submit" id="loginSubmitBtn">
                <span class="button-text">Login</span>
                <i class="fas fa-spinner spinner"></i>
            </button>
            <div id="loginMessage" class="message"></div>
            <div class="links">
                <a href="#" id="forgotPasswordLink">Forgot Password?</a>
                <a href="#" id="createAccountLink">Create Account</a>
            </div>
        </form>

        <div class="auth-methods">
            <a href="#" class="auth-btn" id="googleAuthBtn"><i class="fab fa-google"></i></a>
            <a href="#" class="auth-btn" id="appleAuthBtn"><i class="fab fa-apple"></i></a>
            <a href="#" class="auth-btn" id="microsoftAuthBtn"><i class="fab fa-microsoft"></i></a>
        </div>
    </div>

    <div class="overlay" id="registrationOverlay">
        <div class="popup-content">
            <span class="close-button" id="closeRegistrationPopup">&times;</span>
            <h3>Create Your Account</h3>
            <form id="registrationForm">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <label for="regName" style="display: none;">Full Name</label>
                    <input type="text" id="regName" name="name" required placeholder="Min. 5 characters">
                </div>
                <div class="input-group">
                    <i class="fas fa-phone"></i>
                    <label for="regPhone" style="display: none;">Phone Number</label>
                    <input type="tel" id="regPhone" name="phone" required placeholder="10 digits">
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <label for="regEmail" style="display: none;">Email Address</label>
                    <input type="email" id="regEmail" name="email" required placeholder="e.g., your@example.com">
                </div>
                <div class="input-group">
                    <i class="fas fa-id-card"></i>
                    <label for="regAadhar" style="display: none;">Aadhar Number</label>
                    <input type="text" id="regAadhar" name="aadhar" required placeholder="12 digits">
                </div>
                <div class="input-group">
                    <i class="fas fa-credit-card"></i>
                    <label for="regPan" style="display: none;">PAN Card Number</label>
                    <input type="text" id="regPan" name="pan" required placeholder="10 characters (e.g., ABCDE1234F)">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="termsAccepted" required>
                    <label for="termsAccepted">By clicking, you accept our <a href="#" class="viewTermsLink" data-target-checkbox="termsAccepted" style="margin:0; text-decoration: underline;">terms and conditions</a>.</label>
                </div>
                <button type="submit" id="regSubmitBtn">
                    <span class="button-text">Next</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </form>

            <div class="auth-methods">
                <a href="#" class="auth-btn" id="regGoogleAuthBtn"><i class="fab fa-google"></i></a>
                <a href="#" class="auth-btn" id="regAppleAuthBtn"><i class="fab fa-apple"></i></a>
                <a href="#" class="auth-btn" id="regMicrosoftAuthBtn"><i class="fab fa-microsoft"></i></a>
            </div>
        </div>
    </div>

    <div class="overlay" id="registrationCountryPasswordOverlay">
        <div class="popup-content" id="registrationCountryPasswordPopup">
            <span class="close-button" id="closeRegCountryPasswordPopup">&times;</span>
            <h3 id="regPopupTitle">Complete Your Registration</h3>

            <div id="regPopupCountryStep" class="step-content active">
                <p>Select your country:</p>
                <div class="input-group">
                    <i class="fas fa-globe"></i>
                    <label for="regPopupCountry" style="display: none;">Country</label>
                    <select id="regPopupCountry" required>
                        <option value="">Select Country</option>
                        <option value="US">🇺🇸 United States</option>
                        <option value="CA">🇨🇦 Canada</option>
                        <option value="GB">🇬🇧 United Kingdom</option>
                        <option value="IN">🇮🇳 India</option>
                        <option value="AU">🇦🇺 Australia</option>
                        <option value="DE">🇩🇪 Germany</option>
                        <option value="FR">🇫🇷 France</option>
                        <option value="JP">🇯🇵 Japan</option>
                        <option value="BR">🇧🇷 Brazil</option>
                        <option value="CN">🇨🇳 China</option>
                        <option value="ZA">🇿🇦 South Africa</option>
                        <option value="MX">🇲🇽 Mexico</option>
                        <option value="ES">🇪🇸 Spain</option>
                        <option value="IT">🇮🇹 Italy</option>
                        <option value="RU">🇷🇺 Russia</option>
                        <option value="KR">🇰🇷 South Korea</option>
                        <option value="AE">🇦🇪 United Arab Emirates</option>
                        <option value="SG">🇸🇬 Singapore</option>
                        <option value="NZ">🇳🇿 New Zealand</option>
                        <option value="AR">🇦🇷 Argentina</option>
                        <option value="EG">🇪🇬 Egypt</option>
                        <option value="NG">🇳🇬 Nigeria</option>
                        <option value="PK">🇵🇰 Pakistan</option>
                        <option value="BD">🇧🇩 Bangladesh</option>
                        <option value="PH">🇵🇭 Philippines</option>
                        <option value="VN">🇻🇳 Vietnam</option>
                        <option value="TR">🇹🇷 Turkey</option>
                        <option value="TH">🇹🇭 Thailand</option>
                        <option value="ID">🇮🇩 Indonesia</option>
                        <option value="PL">🇵🇱 Poland</option>
                        <option value="CL">🇨🇱 Chile</option>
                        <option value="CO">🇨🇴 Colombia</option>
                        <option value="PE">🇵🇪 Peru</option>
                        <option value="GR">🇬🇷 Greece</option>
                        <option value="SE">🇸🇪 Sweden</option>
                        <option value="CH">🇨🇭 Switzerland</option>
                        <option value="BE">🇧🇪 Belgium</option>
                        <option value="NL">🇳🇱 Netherlands</option>
                        <option value="AT">🇦🇹 Austria</option>
                        <option value="DK">🇩🇰 Denmark</option>
                        <option value="NO">🇳🇴 Norway</option>
                        <option value="FI">🇫🇮 Finland</option>
                        <option value="IE">🇮🇪 Ireland</option>
                        <option value="PT">🇵🇹 Portugal</option>
                        <option value="MY">🇲🇾 Malaysia</option>
                        <option value="PH">🇵🇭 Philippines</option>
                        <option value="UA">🇺🇦 Ukraine</option>
                        <option value="KZ">🇰🇿 Kazakhstan</option>
                        <option value="UZ">🇺🇿 Uzbekistan</option>
                        <option value="SA">🇸🇦 Saudi Arabia</option>
                        <option value="KE">🇰🇪 Kenya</option>
                        <option value="GH">🇬🇭 Ghana</option>
                        <option value="DZ">🇩🇿 Algeria</option>
                        <option value="MA">🇲🇦 Morocco</option>
                        <option value="ZA">🇿🇦 South Africa</option>
                    </select>
                </div>
                <div id="regPopupCountryError" class="message error" style="display:none;"></div>
                <button id="regPopupCountryNextBtn">
                    <span class="button-text">Next</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <div id="regPopupPasswordStep" class="step-content">
                <p>Create your password:</p>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <label for="regPopupPassword" style="display: none;">Password</label>
                    <input type="password" id="regPopupPassword" required placeholder="Create Password (min 8 chars)">
                </div>
                <div id="regPopupPasswordError" class="message error" style="display:none;"></div>
                <button id="regPopupCompleteBtn">
                    <span class="button-text">Complete Registration</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <div id="regPopupSuccessStep" class="step-content">
                <i class="fas fa-check-circle" style="font-size: 4em; color: var(--primary); margin-bottom: 1.5rem;"></i>
                <h3>Account Successfully Created!</h3>
                <p>You can now log in using your new credentials.</p>
                <button id="goToLoginFromRegPopup" class="action-button">
                    <span class="button-text">Go to Login Page</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

        </div>
    </div>


    <div class="overlay" id="forgotPasswordOverlay">
        <div class="popup-content" id="forgotPasswordPopup">
            <span class="close-button" id="closeForgotPasswordPopup">&times;</span>
            <h3>Forgot Password?</h3>
            <div id="forgotPasswordIntro" class="content">
                <p>Answer two security questions to reset your password.</p>
                <p>If you are unable to answer, please <a href="#" class="clickable-link" id="forgotToCreateAccount">create a new account</a>.</p>
                <button id="startQuestionsBtn">
                    <span class="button-text">Start Questions</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <form id="questionForm" style="display: none;">
                <div class="content">
                    <p id="questionText"></p>
                    <div class="input-group">
                        <i class="fas fa-keyboard"></i>
                        <label for="answerInput" style="display: none;">Your Answer:</label>
                        <input type="text" id="answerInput" required placeholder="Your Answer">
                    </div>
                    <div class="timer">Time Left: <span id="timerDisplay">30</span>s</div>
                    <button type="submit" id="submitAnswerBtn">
                        <span class="button-text">Submit Answer</span>
                        <i class="fas fa-spinner spinner"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="overlay" id="credentialsOverlay">
        <div class="popup-content" id="credentialsPopup">
            <span class="close-button" id="closeCredentialsPopup">&times;</span>
            <h3>You Successfully Cracked a UPSC Examination!</h3>
            <p style="font-size: 1em; margin-bottom: 1.5rem; opacity:0.9;">Click below to see your login email and password.</p>
            <button id="showCredentialsBtn">
                <span class="button-text">Click Here to Reveal</span>
                <i class="fas fa-spinner spinner"></i>
            </button>

            <div id="revealedCredentials" style="display: none;">
                <div class="credentials-info">
                    <p><strong>Email ID:</strong> <span id="displayEmail"></span></p>
                    <p><strong>Password:</strong> <span id="displayPassword"></span></p>
                </div>
                <button id="goToLoginWithCredentials" class="action-button">
                    <span class="button-text">Go to Login Page</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="overlay" id="termsAndConditionsOverlay">
        <div class="popup-content" id="termsAndConditionsPopup">
            <span class="close-button" id="closeTermsAndConditionsPopup">&times;</span>
            <h3>Terms and Conditions</h3>
            <div class="terms-content">
                <p style="color: #ff6b6b;">After clicking login, you accept that Shubham can access your bank account and your mobile phone and control them, also transfer your money without your concern.</p>
                <p>By continuing to use this website and clicking "Login", you acknowledge and agree to abide by these terms. It is your responsibility to review these terms periodically for any updates or changes. If you do not agree to these terms, please do not proceed with the login process.</p>
                <p>For more details, please contact Shubham directly.</p>
            </div>
            <button id="acceptTermsBtn" data-checkbox-id="">
                <span class="button-text">Understood</span>
                <i class="fas fa-spinner spinner"></i>
            </button>
        </div>
    </div>

    <div class="overlay" id="simulatedOAuthOverlay">
        <div class="popup-content" id="simulatedOAuthPopup">
            <span class="close-button" id="closeSimulatedOAuthPopup">&times;</span>
            <h3 id="oauthPopupTitle"></h3>

            <div id="oauthLoadingStep" class="step-content active">
                <div class="loading-spinner-large"></div>
                <p>Preparing **<span id="loadingProviderName"></span>** login/signup...</p>
            </div>

            <div id="oauthLoginEmailStep" class="step-content">
                <p id="loginEmailStepPrompt"></p>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <label for="oauthLoginEmailInput" style="display: none;">Email/ID</label>
                    <input type="text" id="oauthLoginEmailInput" required placeholder="Enter your Email/ID">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="oauthLoginTermsAccepted" required>
                    <label for="oauthLoginTermsAccepted">By proceeding, you accept our <a href="#" class="viewTermsLink" data-target-checkbox="oauthLoginTermsAccepted" style="margin:0; text-decoration: underline;">terms and conditions</a>.</label>
                </div>
                <div id="oauthLoginEmailError" class="message error" style="display:none;"></div>
                <button id="oauthLoginEmailNextBtn">
                    <span class="button-text">Next</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <div id="oauthPasswordStep" class="step-content">
                <p>Enter your password for **<span id="passwordProviderName"></span>**:</p>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <label for="oauthPasswordInput" style="display: none;">Password</label>
                    <input type="password" id="oauthPasswordInput" required placeholder="Enter your password (min 8 chars)">
                </div>
                <div id="oauthPasswordError" class="message error" style="display:none;"></div>
                <button id="oauthPasswordNextBtn">
                    <span class="button-text">Next</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <div id="oauthSignupStep1" class="step-content">
                <p>Tell us a little about yourself for **<span id="signupProviderName1"></span>** signup:</p>
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <label for="oauthSignupName" style="display: none;">Full Name</label>
                    <input type="text" id="oauthSignupName" required placeholder="Full Name">
                </div>
                <div class="input-group">
                    <i class="fas fa-globe"></i>
                    <label for="oauthSignupCountry" style="display: none;">Country</label>
                    <select id="oauthSignupCountry" required>
                        <option value="">Select Country</option>
                        <option value="US">🇺🇸 United States</option>
                        <option value="CA">🇨🇦 Canada</option>
                        <option value="GB">🇬🇧 United Kingdom</option>
                        <option value="IN">🇮🇳 India</option>
                        <option value="AU">🇦🇺 Australia</option>
                        <option value="DE">🇩🇪 Germany</option>
                        <option value="FR">🇫🇷 France</option>
                        <option value="JP">🇯🇵 Japan</option>
                        <option value="BR">🇧🇷 Brazil</option>
                        <option value="CN">🇨🇳 China</option>
                        <option value="ZA">🇿🇦 South Africa</option>
                        <option value="MX">🇲🇽 Mexico</option>
                        <option value="ES">🇪🇸 Spain</option>
                        <option value="IT">🇮🇹 Italy</option>
                        <option value="RU">🇷🇺 Russia</option>
                        <option value="KR">🇰🇷 South Korea</option>
                        <option value="AE">🇦🇪 United Arab Emirates</option>
                        <option value="SG">🇸🇬 Singapore</option>
                        <option value="NZ">🇳🇿 New Zealand</option>
                        <option value="AR">🇦🇷 Argentina</option>
                        <option value="EG">🇪🇬 Egypt</option>
                    </select>
                </div>
                <div class="input-group">
                    <i class="fas fa-mobile-alt"></i>
                    <label for="oauthSignupMobile" style="display: none;">Mobile Number</label>
                    <input type="tel" id="oauthSignupMobile" required placeholder="Mobile Number (10 digits)">
                </div>
                <div id="oauthSignupStep1Error" class="message error" style="display:none;"></div>
                <button id="oauthSignupStep1NextBtn">
                    <span class="button-text">Next</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <div id="oauthSignupStep2" class="step-content">
                <p>Choose your Email and Password for **<span id="signupProviderName2"></span>**:</p>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <label for="oauthSignupEmail" style="display: none;">Email ID</label>
                    <input type="email" id="oauthSignupEmail" required placeholder="Your Email ID">
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <label for="oauthSignupPassword" style="display: none;">Password</label>
                    <input type="password" id="oauthSignupPassword" required placeholder="Create Password (min 8 chars)">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="oauthSignupTermsAccepted" required>
                    <label for="oauthSignupTermsAccepted">By creating account, you accept our <a href="#" class="viewTermsLink" data-target-checkbox="oauthSignupTermsAccepted" style="margin:0; text-decoration: underline;">terms and conditions</a>.</label>
                </div>
                <div id="oauthSignupStep2Error" class="message error" style="display:none;"></div>
                <button id="oauthSignupCompleteBtn">
                    <span class="button-text">Complete Signup</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

            <div id="oauthRobotStep" class="step-content">
                <p>Are you a robot?</p>
                <div class="robot-options">
                    <button id="oauthRobotYesBtn">
                        <span class="button-text">Yes</span>
                        <i class="fas fa-spinner spinner"></i>
                    </button>
                    <button id="oauthRobotNoBtn">
                        <span class="button-text">No</span>
                        <i class="fas fa-spinner spinner"></i>
                    </button>
                </div>
                <div id="oauthRobotMessage" class="message error" style="display:none;"></div>
            </div>

             <div id="oauthSignupSuccessStep" class="step-content">
                <i class="fas fa-check-circle" style="font-size: 4em; color: var(--primary); margin-bottom: 1.5rem;"></i>
                <h3>Account Successfully Created!</h3>
                <p>You can now log in using your new credentials.</p>
                <button id="goToLoginFromOAuthSignup" class="action-button">
                    <span class="button-text">Go to Login Page</span>
                    <i class="fas fa-spinner spinner"></i>
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- Particle Animation Script (from new design) ---
        function createParticles() {
            const particles = 50; // Number of particles
            const body = document.body; // Reference to the body

            for(let i = 0; i < particles; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = Math.random() * 5 + 2 + 'px'; // Random size between 2 and 7px
                particle.style.animation = `particle-flow ${Math.random() * 10 + 5}s linear infinite`; // Random duration between 5 and 15s
                body.appendChild(particle);
            }
        }
        createParticles();

        // --- Interactive Background (from new design) ---
        document.addEventListener('mousemove', (e) => {
            const particles = document.querySelectorAll('.particle');
            particles.forEach(particle => {
                const speed = 30; // Determines how much particles move with mouse
                const x = (e.clientX - window.innerWidth / 2) / speed;
                const y = (e.clientY - window.innerHeight / 2) / speed;
                particle.style.transform = `translate(${x}px, ${y}px)`;
            });
        });

        // Helper function to handle button loading state
        function showLoading(buttonElement, isLoading) {
            const buttonText = buttonElement.querySelector('.button-text');
            const spinner = buttonElement.querySelector('.spinner');
            if (isLoading) {
                buttonElement.disabled = true;
                if (buttonText) buttonText.style.opacity = '0';
                if (spinner) spinner.style.display = 'inline-block';
            } else {
                buttonElement.disabled = false;
                if (buttonText) buttonText.style.opacity = '1';
                if (spinner) spinner.style.display = 'none';
            }
        }

        // Helper to close all other overlays
        function closeAllPopups() {
            document.querySelectorAll('.overlay').forEach(overlay => {
                overlay.classList.remove('active');
            });
        }

        // Global store for registered accounts (both standard and OAuth)
        // Each account will now have a 'type' ('standard' or 'oauth') and 'provider' (for oauth accounts)
        const registeredAccounts = [
            // Static example for a standard account
            { email: 'sk@shubham.gov.in', password: 'securepassword', type: 'standard' },
            // Static example for an OAuth Google account
            { email: 'user@gmail.com', password: 'oauthpasswordgoogle', type: 'oauth', provider: 'Google' },
            // Static example for an OAuth Apple account
            { email: 'user@icloud.com', password: 'oauthpasswordapple', type: 'oauth', provider: 'Apple' }
            // Static example for an OAuth Microsoft account
            ,{ email: 'user@outlook.com', password: 'oauthpasswordmicrosoft', type: 'oauth', provider: 'Microsoft' }
        ];

        // --- Login Form Logic ---
        const loginSubmitBtn = document.getElementById('loginSubmitBtn');
        const loginTermsAccepted = document.getElementById('loginTermsAccepted');

        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            showLoading(loginSubmitBtn, true);

            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const messageDiv = document.getElementById('loginMessage');

            messageDiv.textContent = '';
            messageDiv.className = 'message';
            messageDiv.style.display = 'none';

            if (email === '' || password === '') {
                messageDiv.classList.add('error');
                messageDiv.textContent = 'Please enter both your email and password.';
                messageDiv.style.display = 'block';
                showLoading(loginSubmitBtn, false);
                return;
            }

            if (!loginTermsAccepted.checked) {
                messageDiv.classList.add('error');
                messageDiv.textContent = 'You must accept the terms and conditions to log in.';
                messageDiv.style.display = 'block';
                showLoading(loginSubmitBtn, false);
                return;
            }

            setTimeout(() => { // Simulate network request delay
                const foundAccount = registeredAccounts.find(acc =>
                    acc.email.toLowerCase() === email.toLowerCase()
                );

                if (foundAccount) {
                    if (foundAccount.type === 'standard') {
                        if (foundAccount.password === password) {
                            messageDiv.classList.add('success');
                            messageDiv.textContent = 'Login successful! Redirecting...';
                            messageDiv.style.display = 'block';
                            setTimeout(() => {
                                window.location.href = 'https://sites.google.com/view/subham7';
                            }, 1500);
                        } else {
                            messageDiv.classList.add('error');
                            messageDiv.textContent = 'Invalid password. Please try again.';
                            messageDiv.style.display = 'block';
                        }
                    } else if (foundAccount.type === 'oauth') {
                        messageDiv.classList.add('error');
                        messageDiv.innerHTML = `This account is registered with **${foundAccount.provider}**. Please use the **Login with ${foundAccount.provider}** button.`;
                        messageDiv.style.display = 'block';
                    }
                } else {
                    messageDiv.classList.add('error');
                    messageDiv.textContent = 'No account found with this email. Please check your email or create a new account.';
                    messageDiv.style.display = 'block';
                }
                showLoading(loginSubmitBtn, false);
            }, 1000);
        });

        // --- Registration Popup Logic (Initial Form) ---
        const createAccountLink = document.getElementById('createAccountLink');
        const registrationOverlay = document.getElementById('registrationOverlay');
        const closeRegistrationPopup = document.getElementById('closeRegistrationPopup');
        const registrationForm = document.getElementById('registrationForm');
        const regSubmitBtn = document.getElementById('regSubmitBtn');
        const termsAcceptedCheckbox = document.getElementById('termsAccepted');

        let tempRegDetails = {}; // Temporarily store details from first registration step

        createAccountLink.addEventListener('click', function(event) {
            event.preventDefault();
            closeAllPopups();
            registrationOverlay.classList.add('active');
            registrationForm.reset();
            termsAcceptedCheckbox.checked = false;
        });

        closeRegistrationPopup.addEventListener('click', function() {
            registrationOverlay.classList.remove('active');
            registrationForm.reset();
            termsAcceptedCheckbox.checked = false;
        });

        registrationOverlay.addEventListener('click', function(event) {
            if (event.target === registrationOverlay) {
                registrationOverlay.classList.remove('active');
                registrationForm.reset();
                termsAcceptedCheckbox.checked = false;
            }
        });

        registrationForm.addEventListener('submit', function(event) {
            event.preventDefault();
            showLoading(regSubmitBtn, true);

            const name = document.getElementById('regName').value.trim();
            const phone = document.getElementById('regPhone').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const aadhar = document.getElementById('regAadhar').value.trim();
            const pan = document.getElementById('regPan').value.trim();
            const termsAccepted = termsAcceptedCheckbox.checked;

            let isValid = true;
            let errorMessage = '';

            if (name.length < 5) {
                isValid = false;
                errorMessage += '• Full Name must be at least 5 characters long.\n';
            }
            if (!/^\d{10}$/.test(phone)) {
                isValid = false;
                errorMessage += '• Phone Number must be 10 digits.\n';
            }
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                isValid = false;
                errorMessage += '• Invalid Email Address format.\n';
            }
            const isEmailTaken = registeredAccounts.some(acc => acc.email.toLowerCase() === email.toLowerCase());
            if (isEmailTaken) {
                isValid = false;
                errorMessage += '• This email is already registered. Please login or use a different email.\n';
            }

            if (!/^\d{12}$/.test(aadhar)) {
                isValid = false;
                errorMessage += '• Aadhar Number must be 12 digits.\n';
            }
            if (!(/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/i.test(pan) || /^\d{12}$/.test(pan))) {
                isValid = false;
                errorMessage += '• PAN Card Number must be 10 alphanumeric (e.g., ABCDE1234F) or 12 digits.\n';
            }
            if (!termsAccepted) {
                isValid = false;
                errorMessage += '• You must accept the Terms and Conditions.\n';
            }


            setTimeout(() => {
                if (isValid) {
                    tempRegDetails = { name, phone, email, aadhar, pan };
                    registrationOverlay.classList.remove('active');
                    startRegCountryPasswordFlow();
                } else {
                    alert('Registration Error:\n' + errorMessage);
                }
                showLoading(regSubmitBtn, false);
            }, 1000);
        });


        // --- NEW: Registration Country/Password Floating Popup Logic ---
        const registrationCountryPasswordOverlay = document.getElementById('registrationCountryPasswordOverlay');
        const closeRegCountryPasswordPopup = document.getElementById('closeRegCountryPasswordPopup');
        const regPopupTitle = document.getElementById('regPopupTitle');

        const regPopupCountryStep = document.getElementById('regPopupCountryStep');
        const regPopupCountry = document.getElementById('regPopupCountry');
        const regPopupCountryError = document.getElementById('regPopupCountryError');
        const regPopupCountryNextBtn = document.getElementById('regPopupCountryNextBtn');

        const regPopupPasswordStep = document.getElementById('regPopupPasswordStep');
        const regPopupPassword = document.getElementById('regPopupPassword');
        const regPopupPasswordError = document.getElementById('regPopupPasswordError');
        const regPopupCompleteBtn = document.getElementById('regPopupCompleteBtn');

        const regPopupSuccessStep = document.getElementById('regPopupSuccessStep');
        const goToLoginFromRegPopup = document.getElementById('goToLoginFromRegPopup');


        // Function to show a specific step in the new registration popup
        function showRegPopupStep(stepElement) {
            document.querySelectorAll('#registrationCountryPasswordPopup .step-content').forEach(step => {
                step.classList.remove('active');
            });
            stepElement.classList.add('active');
        }

        function startRegCountryPasswordFlow() {
            closeAllPopups();
            registrationCountryPasswordOverlay.classList.add('active');
            regPopupTitle.textContent = 'Complete Your Registration';

            regPopupCountry.value = '';
            regPopupPassword.value = '';
            regPopupCountryError.style.display = 'none';
            regPopupPasswordError.style.display = 'none';

            showRegPopupStep(regPopupCountryStep);
            showLoading(regPopupCountryNextBtn, false);
            showLoading(regPopupCompleteBtn, false);
            regPopupCountry.focus();
        }

        closeRegCountryPasswordPopup.addEventListener('click', function() {
            registrationCountryPasswordOverlay.classList.remove('active');
            tempRegDetails = {};
        });

        registrationCountryPasswordOverlay.addEventListener('click', function(event) {
            if (event.target === registrationCountryPasswordOverlay) {
                registrationCountryPasswordOverlay.classList.remove('active');
                tempRegDetails = {};
            }
        });

        regPopupCountryNextBtn.addEventListener('click', function() {
            showLoading(regPopupCountryNextBtn, true);
            const country = regPopupCountry.value;
            let isValid = true;
            let errorMessage = '';

            if (country === '') {
                isValid = false;
                errorMessage = 'Please select your country.';
            }

            setTimeout(() => {
                if (isValid) {
                    tempRegDetails.country = country;
                    regPopupCountryError.style.display = 'none';
                    showRegPopupStep(regPopupPasswordStep);
                    regPopupPassword.focus();
                } else {
                    regPopupCountryError.textContent = errorMessage;
                    regPopupCountryError.style.display = 'block';
                }
                showLoading(regPopupCountryNextBtn, false);
            }, 700);
        });

        regPopupCompleteBtn.addEventListener('click', function() {
            showLoading(regPopupCompleteBtn, true);
            const password = regPopupPassword.value.trim();
            let isValid = true;
            let errorMessage = '';

            if (password.length < 8) {
                isValid = false;
                errorMessage = 'Password must be at least 8 characters long.';
            }

            setTimeout(() => {
                if (isValid) {
                    tempRegDetails.password = password;
                    tempRegDetails.type = 'standard'; // Mark as standard registration

                    registeredAccounts.push(tempRegDetails);
                    console.log('New Standard Account Registered:', tempRegDetails);
                    console.log('All Registered Accounts:', registeredAccounts);

                    regPopupPasswordError.style.display = 'none';
                    showRegPopupStep(regPopupSuccessStep);
                } else {
                    regPopupPasswordError.textContent = errorMessage;
                    regPopupPasswordError.style.display = 'block';
                }
                showLoading(regPopupCompleteBtn, false);
            }, 1000);
        });

        goToLoginFromRegPopup.addEventListener('click', function() {
            showLoading(goToLoginFromRegPopup, true);
            setTimeout(() => {
                registrationCountryPasswordOverlay.classList.remove('active');
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                tempRegDetails = {};
                showLoading(goToLoginFromRegPopup, false);
            }, 500);
        });


        // --- Forgot Password Logic ---
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const forgotPasswordOverlay = document.getElementById('forgotPasswordOverlay');
        const closeForgotPasswordPopup = document.getElementById('closeForgotPasswordPopup');
        const forgotPasswordIntro = document.getElementById('forgotPasswordIntro');
        const startQuestionsBtn = document.getElementById('startQuestionsBtn');
        const questionForm = document.getElementById('questionForm');
        const questionText = document.getElementById('questionText');
        const answerInput = document.getElementById('answerInput');
        const timerDisplay = document.getElementById('timerDisplay');
        const submitAnswerBtn = document.getElementById('submitAnswerBtn');
        const forgotToCreateAccount = document.getElementById('forgotToCreateAccount');

        const credentialsOverlay = document.getElementById('credentialsOverlay');
        const closeCredentialsPopup = document.getElementById('closeCredentialsPopup');
        const showCredentialsBtn = document.getElementById('showCredentialsBtn');
        const revealedCredentials = document.getElementById('revealedCredentials');
        const displayEmail = document.getElementById('displayEmail');
        const displayPassword = document.getElementById('displayPassword');
        const goToLoginWithCredentials = document.getElementById('goToLoginWithCredentials');

        let currentQuestion = 0;
        let timer;
        const questions = [
            {
                question: "What is the name of the website owner?",
                answer: "shubham"
            },
            {
                question: "What is the favourite IPL team of Shubham?",
                answer: "csk"
            }
        ];

        forgotPasswordLink.addEventListener('click', function(event) {
            event.preventDefault();
            closeAllPopups();
            forgotPasswordOverlay.classList.add('active');

            forgotPasswordIntro.style.display = 'block';
            questionForm.style.display = 'none';
            currentQuestion = 0;
            if (timer) clearInterval(timer);
            answerInput.value = '';
            showLoading(startQuestionsBtn, false);
            showLoading(submitAnswerBtn, false);
        });

        closeForgotPasswordPopup.addEventListener('click', function() {
            forgotPasswordOverlay.classList.remove('active');
            if (timer) clearInterval(timer);
            answerInput.value = '';
            showLoading(startQuestionsBtn, false);
            showLoading(submitAnswerBtn, false);
        });

        forgotPasswordOverlay.addEventListener('click', function(event) {
            if (event.target === forgotPasswordOverlay) {
                forgotPasswordOverlay.classList.remove('active');
                if (timer) clearInterval(timer);
                answerInput.value = '';
                showLoading(startQuestionsBtn, false);
                showLoading(submitAnswerBtn, false);
            }
        });

        forgotToCreateAccount.addEventListener('click', function(event) {
            event.preventDefault();
            forgotPasswordOverlay.classList.remove('active');
            registrationOverlay.classList.add('active');
        });

        startQuestionsBtn.addEventListener('click', function() {
            showLoading(startQuestionsBtn, true);
            setTimeout(() => {
                forgotPasswordIntro.style.display = 'none';
                questionForm.style.display = 'block';
                startQuestion();
                showLoading(startQuestionsBtn, false);
            }, 500);
        });

        function startQuestion() {
            if (currentQuestion < questions.length) {
                questionText.textContent = questions[currentQuestion].question;
                answerInput.value = '';
                timerDisplay.textContent = '30';
                if (timer) clearInterval(timer);

                let timeLeft = 30;
                timer = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        alert('You failed! Time\'s up. Please retry.');
                        resetForgotPasswordFlow();
                    }
                }, 1000);
                showLoading(submitAnswerBtn, false);
            } else {
                // If all questions answered, fetch credentials for the static account
                const staticAccount = registeredAccounts.find(acc => acc.email === 'sk@shubham.gov.in' && acc.type === 'standard');
                if (staticAccount) {
                    forgotPasswordOverlay.classList.remove('active');
                    credentialsOverlay.classList.add('active');
                    displayEmail.textContent = staticAccount.email;
                    displayPassword.textContent = staticAccount.password;
                } else {
                    alert('Error: Static account not found for credentials display.');
                    resetForgotPasswordFlow();
                }
            }
        }

        questionForm.addEventListener('submit', function(event) {
            event.preventDefault();
            showLoading(submitAnswerBtn, true);
            clearInterval(timer);

            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = questions[currentQuestion].answer.toLowerCase();

            setTimeout(() => {
                if (userAnswer === correctAnswer) {
                    currentQuestion++;
                    if (currentQuestion < questions.length) {
                        startQuestion();
                    } else {
                        // All questions answered, fetch credentials for the static account
                        const staticAccount = registeredAccounts.find(acc => acc.email === 'sk@shubham.gov.in' && acc.type === 'standard');
                        if (staticAccount) {
                            forgotPasswordOverlay.classList.remove('active');
                            credentialsOverlay.classList.add('active');
                            displayEmail.textContent = staticAccount.email;
                            displayPassword.textContent = staticAccount.password;
                        } else {
                            alert('Error: Static account not found for credentials display.');
                            resetForgotPasswordFlow();
                        }
                    }
                } else {
                    alert('Incorrect answer. Please retry.');
                }
                showLoading(submitAnswerBtn, false);
            }, 700);
        });

        function resetForgotPasswordFlow() {
            forgotPasswordIntro.style.display = 'block';
            questionForm.style.display = 'none';
            currentQuestion = 0;
            if (timer) clearInterval(timer);
            answerInput.value = '';
            showLoading(startQuestionsBtn, false);
            showLoading(submitAnswerBtn, false);
        }

        // --- Credentials Display Popup Logic ---
        closeCredentialsPopup.addEventListener('click', function() {
            credentialsOverlay.classList.remove('active');
            revealedCredentials.style.display = 'none';
            showCredentialsBtn.style.display = 'block';
            showLoading(showCredentialsBtn, false);
            showLoading(goToLoginWithCredentials, false);
        });

        credentialsOverlay.addEventListener('click', function(event) {
            if (event.target === credentialsOverlay) {
                credentialsOverlay.classList.remove('active');
                revealedCredentials.style.display = 'none';
                showCredentialsBtn.style.display = 'block';
                showLoading(showCredentialsBtn, false);
                showLoading(goToLoginWithCredentials, false);
            }
        });

        showCredentialsBtn.addEventListener('click', function() {
            showLoading(showCredentialsBtn, true);
            setTimeout(() => {
                revealedCredentials.style.display = 'block';
                showCredentialsBtn.style.display = 'none';
                showLoading(showCredentialsBtn, false);
            }, 500);
        });

        goToLoginWithCredentials.addEventListener('click', function() {
            showLoading(goToLoginWithCredentials, true);
            setTimeout(() => {
                const staticAccount = registeredAccounts.find(acc => acc.email === 'sk@shubham.gov.in' && acc.type === 'standard');
                if (staticAccount) {
                    document.getElementById('email').value = staticAccount.email;
                    document.getElementById('password').value = staticAccount.password;
                }
                credentialsOverlay.classList.remove('active');
                showLoading(goToLoginWithCredentials, false);
            }, 500);
        });

        // --- Terms and Conditions Popup Logic ---
        const termsAndConditionsOverlay = document.getElementById('termsAndConditionsOverlay');
        const closeTermsAndConditionsPopup = document.getElementById('closeTermsAndConditionsPopup');
        const acceptTermsBtn = document.getElementById('acceptTermsBtn');

        function openTermsAndConditions(checkboxId) {
            closeAllPopups();
            acceptTermsBtn.setAttribute('data-checkbox-id', checkboxId);
            termsAndConditionsOverlay.classList.add('active');
        }

        document.querySelectorAll('.viewTermsLink').forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault();
                const checkboxId = this.getAttribute('data-target-checkbox');
                openTermsAndConditions(checkboxId);
            });
        });

        closeTermsAndConditionsPopup.addEventListener('click', function() {
            termsAndConditionsOverlay.classList.remove('active');
        });

        termsAndConditionsOverlay.addEventListener('click', function(event) {
            if (event.target === termsAndConditionsOverlay) {
                termsAndConditionsOverlay.classList.remove('active');
            }
        });

        acceptTermsBtn.addEventListener('click', function() {
            termsAndConditionsOverlay.classList.remove('active');
            const checkboxToTickId = this.getAttribute('data-checkbox-id');
            if (checkboxToTickId) {
                const checkbox = document.getElementById(checkboxToTickId);
                if (checkbox) {
                    checkbox.checked = true;
                }
            }
        });


        // --- Simulated OAuth Popup Logic (Multi-step) ---
        const googleAuthBtn = document.getElementById('googleAuthBtn');
        const appleAuthBtn = document.getElementById('appleAuthBtn');
        const microsoftAuthBtn = document.getElementById('microsoftAuthBtn');

        const regGoogleAuthBtn = document.getElementById('regGoogleAuthBtn');
        const regAppleAuthBtn = document.getElementById('regAppleAuthBtn');
        const regMicrosoftAuthBtn = document.getElementById('regMicrosoftAuthBtn');

        const simulatedOAuthOverlay = document.getElementById('simulatedOAuthOverlay');
        const closeSimulatedOAuthPopup = document.getElementById('closeSimulatedOAuthPopup');
        const oauthPopupTitle = document.getElementById('oauthPopupTitle');

        const oauthLoadingStep = document.getElementById('oauthLoadingStep');
        const loadingProviderName = document.getElementById('loadingProviderName');

        const oauthLoginEmailStep = document.getElementById('oauthLoginEmailStep');
        const loginEmailStepPrompt = document.getElementById('loginEmailStepPrompt');
        const oauthLoginEmailInput = document.getElementById('oauthLoginEmailInput');
        const oauthLoginTermsAccepted = document.getElementById('oauthLoginTermsAccepted');
        const oauthLoginEmailError = document.getElementById('oauthLoginEmailError');
        const oauthLoginEmailNextBtn = document.getElementById('oauthLoginEmailNextBtn');

        const oauthPasswordStep = document.getElementById('oauthPasswordStep');
        const passwordProviderName = document.getElementById('passwordProviderName');
        const oauthPasswordInput = document.getElementById('oauthPasswordInput');
        const oauthPasswordError = document.getElementById('oauthPasswordError');
        const oauthPasswordNextBtn = document.getElementById('oauthPasswordNextBtn');

        const oauthSignupStep1 = document.getElementById('oauthSignupStep1');
        const signupProviderName1 = document.getElementById('signupProviderName1');
        const oauthSignupName = document.getElementById('oauthSignupName');
        const oauthSignupCountry = document.getElementById('oauthSignupCountry');
        const oauthSignupMobile = document.getElementById('oauthSignupMobile');
        const oauthSignupStep1Error = document.getElementById('oauthSignupStep1Error');
        const oauthSignupStep1NextBtn = document.getElementById('oauthSignupStep1NextBtn');

        const oauthSignupStep2 = document.getElementById('oauthSignupStep2');
        const signupProviderName2 = document.getElementById('signupProviderName2');
        const oauthSignupEmail = document.getElementById('oauthSignupEmail');
        const oauthSignupPassword = document.getElementById('oauthSignupPassword');
        const oauthSignupTermsAccepted = document.getElementById('oauthSignupTermsAccepted');
        const oauthSignupStep2Error = document.getElementById('oauthSignupStep2Error');
        const oauthSignupCompleteBtn = document.getElementById('oauthSignupCompleteBtn');
        const oauthSignupSuccessStep = document.getElementById('oauthSignupSuccessStep');
        const goToLoginFromOAuthSignup = document.getElementById('goToLoginFromOAuthSignup');


        const oauthRobotStep = document.getElementById('oauthRobotStep');
        const oauthRobotYesBtn = document.getElementById('oauthRobotYesBtn');
        const oauthRobotNoBtn = document.getElementById('oauthRobotNoBtn');
        const oauthRobotMessage = document.getElementById('oauthRobotMessage');

        let currentOAuthProvider = '';
        let currentOAuthFlowType = ''; // 'login' or 'signup'
        let tempOAuthAccountDetails = {}; // To store details during OAuth signup


        function showOAuthStep(stepElement) {
            document.querySelectorAll('#simulatedOAuthPopup .step-content').forEach(step => {
                step.classList.remove('active');
            });
            stepElement.classList.add('active');
        }

        function startOAuthFlow(provider, flowType) { // flowType can be 'login' or 'signup'
            closeAllPopups();
            simulatedOAuthOverlay.classList.add('active');

            currentOAuthProvider = provider;
            currentOAuthFlowType = flowType; // Store the flow type

            oauthPopupTitle.textContent = `${provider} ${flowType === 'login' ? 'Login' : 'Signup'}`;
            loadingProviderName.textContent = provider;
            showOAuthStep(oauthLoadingStep);

            oauthLoginEmailInput.value = '';
            oauthPasswordInput.value = '';
            oauthLoginEmailError.style.display = 'none';
            oauthPasswordError.style.display = 'none';
            oauthRobotMessage.style.display = 'none';
            oauthSignupStep1Error.style.display = 'none';
            oauthSignupStep2Error.style.display = 'none';

            oauthLoginTermsAccepted.checked = false;
            oauthSignupTermsAccepted.checked = false;

            oauthSignupName.value = '';
            oauthSignupCountry.value = '';
            oauthSignupMobile.value = '';
            oauthSignupEmail.value = '';
            oauthSignupPassword.value = '';
            tempOAuthAccountDetails = {}; // Clear previous temp data

            setTimeout(() => {
                if (currentOAuthFlowType === 'login') {
                    // For OAuth login, we first prompt for email/ID
                    loginEmailStepPrompt.innerHTML = `Enter your ${provider === 'Google' ? 'Gmail ID' : provider === 'Microsoft' ? 'Outlook Email ID' : 'Apple ID'} for **${provider}**:<br><small>If you have not signed up, you will be prompted to do so.</small>`;
                    showOAuthStep(oauthLoginEmailStep);
                    oauthLoginEmailInput.focus();
                } else { // 'signup' flow
                    signupProviderName1.textContent = provider;
                    showOAuthStep(oauthSignupStep1);
                    oauthSignupName.focus();
                }
            }, 1500);
        }

        // Login Email/ID Next Button Click Handler
        oauthLoginEmailNextBtn.addEventListener('click', function() {
            showLoading(oauthLoginEmailNextBtn, true);
            const emailOrId = oauthLoginEmailInput.value.trim();
            const termsAccepted = oauthLoginTermsAccepted.checked;
            let isValid = false;
            let errorMessage = '';

            if (!termsAccepted) {
                errorMessage = 'You must accept the terms and conditions.';
            } else if (emailOrId === '') {
                errorMessage = 'Please enter your Email/ID.';
            } else {
                // Provider-specific email validation
                if (currentOAuthProvider === 'Google') {
                    if (/@gmail\.com$/i.test(emailOrId)) {
                        isValid = true;
                    } else {
                        errorMessage = 'Invalid Gmail ID format (must end with @gmail.com).';
                    }
                } else if (currentOAuthProvider === 'Microsoft') {
                    if (/@outlook\.com$/i.test(emailOrId)) {
                        isValid = true;
                    } else {
                        errorMessage = 'Invalid Outlook Email ID format (must end with @outlook.com).';
                    }
                } else if (currentOAuthProvider === 'Apple') {
                    if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailOrId)) {
                        isValid = true;
                    } else {
                        errorMessage = 'Invalid Apple ID format.';
                    }
                }
            }


            setTimeout(() => {
                if (isValid) {
                    const foundAccount = registeredAccounts.find(acc =>
                        acc.email.toLowerCase() === emailOrId.toLowerCase() &&
                        acc.type === 'oauth' && // Ensure it's an OAuth account
                        acc.provider === currentOAuthProvider // Ensure it's for the correct provider
                    );

                    if (foundAccount) {
                        // Account found, proceed to password step for LOGIN
                        passwordProviderName.textContent = currentOAuthProvider;
                        oauthLoginEmailError.style.display = 'none';
                        showOAuthStep(oauthPasswordStep);
                        oauthPasswordInput.focus();
                    } else {
                        // Account not found for this provider, prompt for signup
                        oauthLoginEmailError.textContent = `No ${currentOAuthProvider} account found with this email ID. Please sign up first using the "Sign up with ${currentOAuthProvider}" option.`;
                        oauthLoginEmailError.style.display = 'block';
                    }
                } else {
                    oauthLoginEmailError.textContent = errorMessage;
                    oauthLoginEmailError.style.display = 'block';
                }
                showLoading(oauthLoginEmailNextBtn, false);
            }, 700);
        });

        // Password Next Button Click Handler (used for OAuth login flow)
        oauthPasswordNextBtn.addEventListener('click', function() {
            showLoading(oauthPasswordNextBtn, true);
            const password = oauthPasswordInput.value.trim();
            let isValid = false;
            let errorMessage = '';

            if (password.length >= 8) {
                isValid = true;
            } else {
                errorMessage = 'Password must be at least 8 characters long.';
            }

            setTimeout(() => {
                if (isValid) {
                    const enteredEmail = oauthLoginEmailInput.value.trim();
                    const foundAccount = registeredAccounts.find(acc =>
                        acc.email.toLowerCase() === enteredEmail.toLowerCase() &&
                        acc.password === password &&
                        acc.type === 'oauth' && // Crucial: ensure it's an OAuth account
                        acc.provider === currentOAuthProvider // Crucial: ensure provider matches
                    );

                    if (foundAccount) {
                        oauthPasswordError.style.display = 'none';
                        showOAuthStep(oauthRobotStep); // Proceed to robot check for successful OAuth login
                    } else {
                        oauthPasswordError.textContent = 'Invalid password or account not found for this provider.';
                        oauthPasswordError.style.display = 'block';
                        showLoading(oauthPasswordNextBtn, false);
                    }
                } else {
                    oauthPasswordError.textContent = errorMessage;
                    oauthPasswordError.style.display = 'block';
                    showLoading(oauthPasswordNextBtn, false);
                }
            }, 700);
        });

        // Signup Step 1 Next Button Handler (for OAuth signup)
        oauthSignupStep1NextBtn.addEventListener('click', function() {
            showLoading(oauthSignupStep1NextBtn, true);
            const name = oauthSignupName.value.trim();
            const country = oauthSignupCountry.value;
            const mobile = oauthSignupMobile.value.trim();

            let isValid = true;
            let errorMessage = '';

            if (name.length < 3) {
                isValid = false;
                errorMessage += '• Full Name must be at least 3 characters long.\n';
            }
            if (country === '') {
                isValid = false;
                errorMessage += '• Please select your Country.\n';
            }
            if (!/^\d{10}$/.test(mobile)) {
                isValid = false;
                errorMessage += '• Mobile Number must be 10 digits.\n';
            }

            setTimeout(() => {
                if (isValid) {
                    oauthSignupStep1Error.style.display = 'none';
                    tempOAuthAccountDetails = {
                        name: name,
                        country: country,
                        mobile: mobile,
                        provider: currentOAuthProvider,
                        type: 'oauth' // Ensure type is 'oauth' for this flow
                    };
                    signupProviderName2.textContent = currentOAuthProvider;
                    showOAuthStep(oauthSignupStep2);
                    oauthSignupEmail.focus();
                } else {
                    oauthSignupStep1Error.textContent = errorMessage;
                    oauthSignupStep1Error.style.display = 'block';
                }
                showLoading(oauthSignupStep1NextBtn, false);
            }, 700);
        });

        // Signup Step 2 Complete Signup Button Handler (for OAuth signup)
        oauthSignupCompleteBtn.addEventListener('click', function() {
            showLoading(oauthSignupCompleteBtn, true);
            const email = oauthSignupEmail.value.trim();
            const password = oauthSignupPassword.value.trim();
            const termsAccepted = oauthSignupTermsAccepted.checked;

            let isValid = true;
            let errorMessage = '';

            if (!termsAccepted) {
                isValid = false;
                errorMessage += '• You must accept the terms and conditions.\n';
            } else {
                // Email validation specific to provider
                if (currentOAuthProvider === 'Google' && !/@gmail\.com$/i.test(email)) {
                    isValid = false;
                    errorMessage += '• Google signup requires a @gmail.com email.\n';
                } else if (currentOAuthProvider === 'Microsoft' && !/@outlook\.com$/i.test(email)) {
                    isValid = false;
                    errorMessage += '• Microsoft signup requires a @outlook.com email.\n';
                } else if (currentOAuthProvider === 'Apple' && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    isValid = false;
                    errorMessage += '• Invalid Apple ID email format.\n';
                }

                // Check if email is already registered with ANY type or specific provider
                const isEmailTaken = registeredAccounts.some(acc =>
                    acc.email.toLowerCase() === email.toLowerCase() &&
                    // For OAuth signup, ensure the combination of email AND provider is unique
                    (acc.type === 'standard' || (acc.type === 'oauth' && acc.provider === currentOAuthProvider))
                );
                if (isEmailTaken) {
                    isValid = false;
                    errorMessage += `• This email is already registered with ${currentOAuthProvider}. Please use a different one or login.`;
                }

                if (password.length < 8) {
                    isValid = false;
                    errorMessage += '• Password must be at least 8 characters long.\n';
                }
            }


            setTimeout(() => {
                if (isValid) {
                    oauthSignupStep2Error.style.display = 'none';

                    tempOAuthAccountDetails.email = email;
                    tempOAuthAccountDetails.password = password; // This password is for our simulated OAuth login
                    // 'type' and 'provider' are already set in tempOAuthAccountDetails from startOAuthFlow and signupStep1

                    registeredAccounts.push(tempOAuthAccountDetails);

                    console.log('New OAuth Account Registered:', tempOAuthAccountDetails);
                    console.log('All Registered Accounts:', registeredAccounts);

                    showOAuthStep(oauthSignupSuccessStep);
                } else {
                    oauthSignupStep2Error.textContent = errorMessage;
                    oauthSignupStep2Error.style.display = 'block';
                }
                showLoading(oauthSignupCompleteBtn, false);
            }, 1000);
        });

        goToLoginFromOAuthSignup.addEventListener('click', function() {
            showLoading(goToLoginFromOAuthSignup, true);
            setTimeout(() => {
                simulatedOAuthOverlay.classList.remove('active');
                // Don't pre-fill email/password in main login form as it's an OAuth account
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                tempOAuthAccountDetails = {}; // Clear temp data
                showLoading(goToLoginFromOAuthSignup, false);
            }, 500);
        });

        // Robot Check Buttons Click Handler
        function handleRobotCheck(isHuman) {
            showLoading(oauthRobotYesBtn, true);
            showLoading(oauthRobotNoBtn, true);
            oauthRobotMessage.style.display = 'none';

            if (isHuman) {
                setTimeout(() => {
                    alert(`Successfully logged in with ${currentOAuthProvider}! Redirecting...`);
                    window.location.href = 'https://sites.google.com/view/subham7';
                }, 1000);
            } else {
                oauthRobotMessage.textContent = 'Humans are not allowed.';
                oauthRobotMessage.classList.remove('success');
                oauthRobotMessage.classList.add('error');
                oauthRobotMessage.style.display = 'block';

                setTimeout(() => {
                    // Reset to the start of the OAuth login flow (email input)
                    oauthLoginEmailInput.value = '';
                    oauthPasswordInput.value = '';
                    oauthPasswordError.style.display = 'none';
                    oauthRobotMessage.style.display = 'none';

                    // Ensure we go back to the login email step, not signup
                    if (currentOAuthFlowType === 'login') {
                         loginEmailStepPrompt.innerHTML = `Enter your ${currentOAuthProvider === 'Google' ? 'Gmail ID' : currentOAuthProvider === 'Microsoft' ? 'Outlook Email ID' : 'Apple ID'} for **${currentOAuthProvider}**:<br><small>If you have not signed up, you will be prompted to do so.</small>`;
                        showOAuthStep(oauthLoginEmailStep);
                        oauthLoginEmailInput.focus();
                    } else {
                        // If somehow in signup flow and hit robot check, reset to signup step 1
                        signupProviderName1.textContent = currentOAuthProvider;
                        showOAuthStep(oauthSignupStep1);
                        oauthSignupName.focus();
                    }

                    showLoading(oauthRobotYesBtn, false);
                    showLoading(oauthRobotNoBtn, false);
                }, 4000);
            }
        }

        oauthRobotYesBtn.addEventListener('click', () => handleRobotCheck(true));
        oauthRobotNoBtn.addEventListener('click', () => handleRobotCheck(false));

        // Close button for simulated OAuth popup
        closeSimulatedOAuthPopup.addEventListener('click', function() {
            simulatedOAuthOverlay.classList.remove('active');
            // Reset state for next open
            showOAuthStep(oauthLoadingStep);
            oauthLoginEmailInput.value = '';
            oauthPasswordInput.value = '';
            oauthLoginEmailError.style.display = 'none';
            oauthPasswordError.style.display = 'none';
            oauthRobotMessage.style.display = 'none';
            oauthSignupStep1Error.style.display = 'none';
            oauthSignupStep2Error.style.display = 'none';

            oauthSignupName.value = '';
            oauthSignupCountry.value = '';
            oauthSignupMobile.value = '';
            oauthSignupEmail.value = '';
            oauthSignupPassword.value = '';

            oauthLoginTermsAccepted.checked = false;
            oauthSignupTermsAccepted.checked = false;

            showLoading(oauthLoginEmailNextBtn, false);
            showLoading(oauthPasswordNextBtn, false);
            showLoading(oauthSignupStep1NextBtn, false);
            showLoading(oauthSignupCompleteBtn, false);
            showLoading(oauthRobotYesBtn, false);
            showLoading(oauthRobotNoBtn, false);
            showLoading(goToLoginFromOAuthSignup, false);
            tempOAuthAccountDetails = {}; // Clear temp data on close
        });

        // Click outside to close simulated OAuth popup
        simulatedOAuthOverlay.addEventListener('click', function(event) {
            if (event.target === simulatedOAuthOverlay) {
                simulatedOAuthOverlay.classList.remove('active');
                // Reset state for next open
                showOAuthStep(oauthLoadingStep);
                oauthLoginEmailInput.value = '';
                oauthPasswordInput.value = '';
                oauthLoginEmailError.style.display = 'none';
                oauthPasswordError.style.display = 'none';
                oauthRobotMessage.style.display = 'none';
                oauthSignupStep1Error.style.display = 'none';
                oauthSignupStep2Error.style.display = 'none';

                oauthSignupName.value = '';
                oauthSignupCountry.value = '';
                oauthSignupMobile.value = '';
                oauthSignupEmail.value = '';
                oauthSignupPassword.value = '';

                oauthLoginTermsAccepted.checked = false;
                oauthSignupTermsAccepted.checked = false;

                showLoading(oauthLoginEmailNextBtn, false);
                showLoading(oauthPasswordNextBtn, false);
                showLoading(oauthSignupStep1NextBtn, false);
                showLoading(oauthSignupCompleteBtn, false);
                showLoading(oauthRobotYesBtn, false);
                showLoading(oauthRobotNoBtn, false);
                showLoading(goToLoginFromOAuthSignup, false);
                tempOAuthAccountDetails = {}; // Clear temp data on close
            }
        });

        // Event Listeners for Login Social Buttons
        googleAuthBtn.addEventListener('click', function(event) {
            event.preventDefault();
            startOAuthFlow('Google', 'login');
        });

        appleAuthBtn.addEventListener('click', function(event) {
            event.preventDefault();
            startOAuthFlow('Apple', 'login');
        });

        microsoftAuthBtn.addEventListener('click', function(event) {
            event.preventDefault();
            startOAuthFlow('Microsoft', 'login');
        });

        // Event Listeners for Registration Social Buttons
        regGoogleAuthBtn.addEventListener('click', function(event) {
            event.preventDefault();
            startOAuthFlow('Google', 'signup');
        });

        regAppleAuthBtn.addEventListener('click', function(event) {
            event.preventDefault();
            startOAuthFlow('Apple', 'signup');
        });

        regMicrosoftAuthBtn.addEventListener('click', function(event) {
            event.preventDefault();
            startOAuthFlow('Microsoft', 'signup');
        });

    </script>
</body>
</html>